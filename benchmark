#!/bin/sh

# prints script usage
bUsage() {
  echo "usage: benchmark [option] cmd"
  echo \
    "options:
      time - benchmark runtimes
      mem  - benchmark memory usage
      cpu  - benchmark cpu usage
      all  - benchmark all options
      help - display usage"
}

# benchmark runtime
bTime() {
  echo "timing"
  # obtain data
  # extract data
}

# profile memory
bMem() {
  echo "profiling mem"

  # profile mem for default case three times
  for round in 0 1 2
  do
    valgrind \
      --tool=massif \
      --massif-out-file=data/mem/default-"$round" \
      python3 "$ROOT"/Tutorial.py
  done
  
  # profile mem for each gridsize three times
  for width in 40 100 160 240
  do
    for round in 0 1 2
    do
      valgrind \
        --tool=massif \
        --massif-out-file=data/mem/width-"$width"-"$round" \
        python3 "$ROOT"/Tutorial.py "$width"
    done
  done
  
  # profile mem for each number of sites three times
  for site in 40 100 160 240
  do
    for round in 0 1 2
    do
      valgrind \
        --tool=massif \
        --massif-out-file=data/mem/site-"$site"-"$round" \
        python3 "$ROOT"/Tutorial.py "$site"
    done
  done

  # extract data
}

# profile cpu usage
bCPU() {
  echo "profiling CPU"
  # obtain data 
  # extract data
}


# cmd line args handler
case "$1" in
  time) bTime "$2" ;;
  mem) bMem "$2" ;;
  cpu) bCPU "$2" ;;
  all) bTime "$2" && bMem "$2" && bCPU "$2" ;;
  help) bUsage ;;
  *) bUsage ;;
esac
